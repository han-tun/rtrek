<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Star Trek API (STAPI) • rtrek</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Star Trek API (STAPI)">
<meta property="og:description" content="">
<meta property="og:image" content="https://leonawicz.github.io/rtrek/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-46129458-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-46129458-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rtrek</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/rtrek.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stapi.html">Star Trek API (STAPI)</a>
    </li>
    <li>
      <a href="../articles/memory-alpha.html">Memory Alpha</a>
    </li>
    <li>
      <a href="../articles/memory-beta.html">Memory Beta</a>
    </li>
    <li>
      <a href="../articles/fonts.html">Star Trek fonts</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Examples</li>
    <li>
      <a href="../articles/ex-word-count.html">Novels: word count</a>
    </li>
    <li>
      <a href="../articles/ex-episode-analysis.html">Episodes: spoken lines</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/sc.html">Stellar Cartography</a>
</li>
<li>
  <a href="../articles/rr.html">R &amp; R... &amp; R</a>
</li>
<li>
  <a href="https://github.com/leonawicz/rtrek">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Star Trek API (STAPI)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/leonawicz/rtrek/blob/master/vignettes/stapi.Rmd"><code>vignettes/stapi.Rmd</code></a></small>
      <div class="hidden name"><code>stapi.Rmd</code></div>

    </div>

    
    
<p>The <code>rtrek</code> package includes some Star Trek datasets, but much more data is available outside the package. You can access other Star Trek data through various APIs.</p>
<p>Technically, there is only one formal API: the Star Trek API (STAPI). <code>rtrek</code> has functions to assist with making calls to this API in order to access specific data. This is the focus of this vignette.</p>
<p><code>rtrek</code> also interfaces with and extracts information from the <a href="http://memory-alpha.wikia.com/">Memory Alpha</a> and <a href="http://memory-beta.wikia.com/">Memory Beta</a> websites. Neither of these sites actually expose an API, but functions in <code>rtrek</code> with querying these websites in an API-like manner. See the respective vignettes for details.</p>
<p>Accessing information from STAPI is covered to some degree in the package <a href="https://leonawicz.github.io/rtrek/articles/rtrek.html">introduction vignette</a>. There is some duplication here, followed by additional examples.</p>
<div id="star-trek-api" class="section level2">
<h2 class="hasAnchor">
<a href="#star-trek-api" class="anchor"></a>Star Trek API</h2>
<p>The <a href="http://stapi.co/">Star Trek API (STAPI)</a> is a particularly useful data source.</p>
<p>Keep in mind that STAPI focuses more on providing real world data associated with Star Trek (e.g., when did episode X first air on television?) than on fictional universe data, but it contains both and the database holdings will grow with time.</p>
<p>To use the words of the developers, the STAPI is</p>
<p><em>the first public Star Trek API, accessible via REST and SOAP. It’s an open source project, that anyone can contribute to.</em></p>
<p>The API is highly functional. Please do not abuse the API with constant requests. Their pages suggest no more than one request per second, but I would suggest ten seconds between successive requests. The default anti-DDOS measures in <code>rtrek</code> limit requests to one per second. You can update this global <code>rtrek</code> setting with <code>options</code>, e.g. <code><a href="https://www.rdocumentation.org/packages/base/topics/options">options(rtrek_antiddos = 10)</a></code> for a minimum ten second wait between API calls to be an even better neighbor. <code>rtrek</code> will not permit faster requests. If set below one second, the option is ignored and a warning thrown when making any API call.</p>
<div id="stapi-entities" class="section level3">
<h3 class="hasAnchor">
<a href="#stapi-entities" class="anchor"></a>STAPI entities</h3>
<p>There a many fields, or entities, available in the API. The available IDs can be found in this table:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">stapiEntities</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; # A tibble: 40 x 4</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#&gt;    id                 class   ncol colnames  </span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;  &lt;int&gt; &lt;list&gt;    </span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt;  1 animal             tbl_df     7 &lt;chr [7]&gt; </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt;  2 astronomicalObject tbl_df     5 &lt;chr [5]&gt; </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt;  3 book               tbl_df    24 &lt;chr [24]&gt;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt;  4 bookCollection     tbl_df    10 &lt;chr [10]&gt;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt;  5 bookSeries         tbl_df    11 &lt;chr [11]&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;  6 character          tbl_df    24 &lt;chr [24]&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt;  7 comicCollection    tbl_df    14 &lt;chr [14]&gt;</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">#&gt;  8 comics             tbl_df    15 &lt;chr [15]&gt;</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">#&gt;  9 comicSeries        tbl_df    15 &lt;chr [15]&gt;</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co">#&gt; 10 comicStrip         tbl_df    12 &lt;chr [12]&gt;</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">#&gt; # ... with 30 more rows</span></a></code></pre></div>
<p>These ID values are passed to <code>stapi</code> to perform a search using the API. The other columns provide some information about the object returned from a search. All entity searches return tibble data frames. You can inspect or unnest the column names of each table returned from every available entity search so you can see beforehand what variables are associated with each entity.</p>
</div>
<div id="accessing-the-api" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-the-api" class="anchor"></a>Accessing the API</h3>
<p>Using <code>stapi</code> should be thought of as a three part process:</p>
<ul>
<li>Determine how many pages of results exist for a particular entity search.</li>
<li>Only after taking care to do the previous step, perform the search to return search results.</li>
<li>If satellite data is needed on a unique observation in the search results, call <code>stapi</code> one more time referencing the specific observation.</li>
</ul>
<p>To determine how many pages of results exist for a given search, set <code>page_count = TRUE</code>. The impact on the API will be equivalent to only searching a single page of results. One page contains metadata including the total number of pages. Nothing is returned in this “safe mode”, but the total number of search results available is printed to the console.</p>
<p>Searching movies only returns one page of results. However, there are a lot of characters in the Star Trek universe. Check the total pages available for character search.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="../reference/stapi.html">stapi</a></span>(<span class="st">"character"</span>, <span class="dt">page_count =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">#&gt; Total pages to retrieve all results: 66</span></a></code></pre></div>
<p>And that is with 100 results per page!</p>
<p>The default <code>page = 1</code> only returns the first page. <code>page</code> can be a vector, e.g. <code>page = 1:62</code>. Results from multi-page searches are automatically combined into a single, constant data frame output. For the second call to <code>stapi</code>, return only page two here, which contains the character, Q (currently, pending future character database updates that may shift the indexing). In case that does change and Q is not always near the top of page two of the search results, the example further below hard-codes his unique/universal ID.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="../reference/stapi.html">stapi</a></span>(<span class="st">"character"</span>, <span class="dt">page =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt; # A tibble: 100 x 24</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt;    uid   name  gender yearOfBirth monthOfBirth dayOfBirth placeOfBirth</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;        &lt;int&gt;      &lt;int&gt; &lt;chr&gt;       </span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">#&gt;  1 CHMA~ Robe~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">#&gt;  2 CHMA~ Romu~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">#&gt;  3 CHMA~ M. M~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">#&gt;  4 CHMA~ Emir~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">#&gt;  5 CHMA~ Tom ~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">#&gt;  6 CHMA~ Aree~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co">#&gt;  7 CHMA~ Lursa &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co">#&gt;  8 CHMA~ Kons~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">#&gt;  9 CHMA~ Harr~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">#&gt; 10 CHMA~ Tezb~ &lt;NA&gt;            NA           NA         NA &lt;NA&gt;        </span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">#&gt; # ... with 90 more rows, and 17 more variables: yearOfDeath &lt;int&gt;,</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co">#&gt; #   monthOfDeath &lt;lgl&gt;, dayOfDeath &lt;lgl&gt;, placeOfDeath &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co">#&gt; #   height &lt;int&gt;, weight &lt;int&gt;, deceased &lt;lgl&gt;, bloodType &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">#&gt; #   maritalStatus &lt;chr&gt;, serialNumber &lt;lgl&gt;, hologramActivationDate &lt;chr&gt;,</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">#&gt; #   hologramStatus &lt;chr&gt;, hologramDateStatus &lt;chr&gt;, hologram &lt;lgl&gt;,</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">#&gt; #   fictionalCharacter &lt;lgl&gt;, mirror &lt;lgl&gt;, alternateReality &lt;lgl&gt;</span></a></code></pre></div>
<p>Character tables can be sparse. There are a lot of variables, many of which will contain missing data for rare, esoteric characters. Even for more popular characters about whom much more universe lore has been uncovered, it still takes dedicated nerds to enter all the data in a database.</p>
<p>When a dataset contains a <code>uid</code> column, this can be used subsequently to extract a satellite dataset about that particular observation that was returned in the original search. First you used safe mode, then search mode, and now switch from search mode to extraction mode to obtain data about Q, specifically. All that is required to do this is pass Q’s <code>uid</code> to <code>stapi</code> and call the function one last time. When <code>uid</code> is no longer <code>NULL</code>, <code>stapi</code> knows not to bother with a search and makes a different type of API call requesting information about the uniquely identified entry.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">Q &lt;-<span class="st"> "CHMA0000025118"</span></a>
<a class="sourceLine" id="cb4-2" title="2">Q &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stapi.html">stapi</a></span>(<span class="st">"character"</span>, <span class="dt">uid =</span> Q)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb4-5" title="5">q_eps &lt;-<span class="st"> </span>Q<span class="op">$</span>episodes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(uid, title, stardateFrom, stardateTo)</a>
<a class="sourceLine" id="cb4-6" title="6">q_eps</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;              uid                 title stardateFrom stardateTo</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; 1 EPMA0000001458    All Good Things...      47988.0    47988.0</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; 2 EPMA0000000845                Q-Less      46531.2    46531.2</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; 3 EPMA0000001329                 Q Who      42761.3    42761.3</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; 4 EPMA0000000651              Tapestry           NA         NA</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; 5 EPMA0000001510    The Q and the Grey      50384.2    50392.7</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; 6 EPMA0000000483 Encounter at Farpoint      41153.7    41153.7</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; 7 EPMA0000162588            Death Wish           NA         NA</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; 8 EPMA0000001413                True Q      46192.3    46192.3</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; 9 EPMA0000001377                  Qpid      44741.9    44741.9</span></a></code></pre></div>
<p>The data returned on Q is actually a large list, including multiple data frames. For simplicity only a piece of it is shown above.</p>
<p>Find out which TNG characters other than Q appear in both the <em>Encounter at Farpoint</em> series premier and later in the <em>All Good Things…</em> series finale. To do this, use<code>stapi</code> to extract data from other endpoints by following a breadcrumb trail of <code>uid</code> values.</p>
<p>Engage.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">eps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Encounter at Farpoint"</span>, <span class="st">"All Good Things..."</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">q_eps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(q_eps, title <span class="op">%in%</span><span class="st"> </span>eps)</a>
<a class="sourceLine" id="cb5-3" title="3">q_eps</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt;              uid                 title stardateFrom stardateTo</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt; 1 EPMA0000001458    All Good Things...      47988.0    47988.0</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; 2 EPMA0000000483 Encounter at Farpoint      41153.7    41153.7</span></a>
<a class="sourceLine" id="cb5-7" title="7">eaf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stapi.html">stapi</a></span>(<span class="st">"episode"</span>, <span class="dt">uid =</span> q_eps<span class="op">$</span>uid[q_eps<span class="op">$</span>title <span class="op">==</span><span class="st"> </span>eps[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb5-8" title="8">agt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stapi.html">stapi</a></span>(<span class="st">"episode"</span>, <span class="dt">uid =</span> q_eps<span class="op">$</span>uid[q_eps<span class="op">$</span>title <span class="op">==</span><span class="st"> </span>eps[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb5-9" title="9">characters &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">setdiff</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sets">intersect</a></span>(eaf<span class="op">$</span>characters<span class="op">$</span>name, agt<span class="op">$</span>characters<span class="op">$</span>name), <span class="st">"Q"</span>)</a>
<a class="sourceLine" id="cb5-10" title="10">characters</a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; [1] "Data"             "William T. Riker" "Geordi La Forge" </span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; [4] "Deanna Troi"      "Jean-Luc Picard"  "Worf"            </span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; [7] "Beverly Crusher"</span></a></code></pre></div>
<p>This returns the main crew members who remained a part of the show from beginning to end. However, Dr. Beverly Crusher was away during season two. Below, inspect how many episodes each character, or actor, appeared in. <code>uid</code> is again needed, this time for each character.</p>
<p>Note that this requires making seven API calls, one for each character ID. The anti-ddos measures in <code>rtrek</code> will force a one-second minimum wait between each call in the event that the individual calls actually return results faster than this, so the code below will take at least seven seconds to complete.</p>
<p>Add a fun, gratuitous Star Trek-themed plot. Make it so.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">characters &lt;-<span class="st"> </span>eaf<span class="op">$</span>characters <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(uid, name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(name <span class="op">%in%</span><span class="st"> </span>characters)</a>
<a class="sourceLine" id="cb6-2" title="2">characters</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt;              uid             name</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; 1 CHMA0000128858             Data</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; 2 CHMA0000123073 William T. Riker</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; 3 CHMA0000132570  Geordi La Forge</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; 4 CHMA0000123101      Deanna Troi</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; 5 CHMA0000132571  Jean-Luc Picard</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; 6 CHMA0000123141             Worf</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; 7 CHMA0000123143  Beverly Crusher</span></a>
<a class="sourceLine" id="cb6-11" title="11">eps_count &lt;-<span class="st"> </span><span class="kw">rowwise</span>(characters) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="st">  </span><span class="kw">do</span>(<span class="kw"><a href="../reference/stapi.html">stapi</a></span>(<span class="st">"character"</span>, <span class="dt">uid =</span> .<span class="op">$</span>uid)<span class="op">$</span>episodes<span class="op">$</span>series <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="st">       </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(title <span class="op">==</span><span class="st"> "Star Trek: The Next Generation"</span>))</a>
<a class="sourceLine" id="cb6-14" title="14">  )</a>
<a class="sourceLine" id="cb6-15" title="15">eps_count &lt;-<span class="st"> </span><span class="kw">select</span>(characters, name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_cols</span>(eps_count)</a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb6-18" title="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(showtext)</a>
<a class="sourceLine" id="cb6-19" title="19"><span class="kw">font_add</span>(<span class="st">"StarNext"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"fonts/StarNext.ttf"</span>), <span class="dt">package =</span> <span class="st">"trekfont"</span>))</a>
<a class="sourceLine" id="cb6-20" title="20"><span class="kw">showtext_auto</span>()</a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22">uniforms &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"#2b53a7"</span>, <span class="st">"#c1c730"</span>, <span class="st">"#a71313"</span>)[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>)]</a>
<a class="sourceLine" id="cb6-23" title="23">eb &lt;-<span class="st"> </span><span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb6-24" title="24"></a>
<a class="sourceLine" id="cb6-25" title="25"><span class="kw">ggplot</span>(eps_count, <span class="kw">aes</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(name, <span class="dt">levels =</span> name[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(n)]), n)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">fill =</span> uniforms, <span class="dt">color =</span> <span class="st">"gray20"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">28</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">"StarNext"</span>), <span class="dt">line =</span> eb, <span class="dt">axis.text.x =</span> eb) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">expand =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Character"</span>, <span class="dt">y =</span> <span class="st">"Number of episodes"</span>, <span class="dt">title =</span> <span class="st">"TNG EPISODE APPEARANCES"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> n), <span class="dt">color =</span> <span class="st">"white"</span>, <span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">hjust =</span> <span class="fl">1.5</span>)</a></code></pre></div>
<p><img src="stapi_files/figure-html/stapi_extract3-1.png" width="100%"></p>
<p>This looks as expected. Inspect the structure of the list objects returned by <code>stapi</code> to become more familiar with what kind of information is available.</p>
</div>
<div id="minor-weirdness" class="section level3">
<h3 class="hasAnchor">
<a href="#minor-weirdness" class="anchor"></a>Minor weirdness</h3>
<p>Sometimes you may receive errors when trying filter rows for one of the data frames while certain problematic columns are still selected. This is likely because the data frame contains a nested data frame, but one which is not nested in the typical way (e.g., <code><a href="https://tidyr.tidyverse.org/reference/unnest.html">tidyr::unnest</a></code> will also fail to resolve the issue).</p>
<p>In the code immediately above, this occurs with the <code>series</code> data frame, which is why the <code>episodes</code> parent data frame is subset using <code>$series</code> before calling <code>summarize</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#star-trek-api">Star Trek API</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://leonawicz.github.io/">Matthew Leonawicz</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
